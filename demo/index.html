<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="cache-control" content="no-cache" />
    <title>Kampos Displacement Demo</title>
    <link rel="stylesheet" href="./lib/codemirror/codemirror.css">
    <style>
        body {
            margin: 0;
            background-image: linear-gradient(-45deg, peachpuff, palegreen, plum, peachpuff, palegreen, plum),
            linear-gradient(45deg, purple, darkblue, rebeccapurple, purple, darkblue, rebeccapurple);
            background-blend-mode: screen;
            font-family: "Nova round", cursive, fantasy;
        }

        header {
            width: fit-content;
            margin:  20vh auto;
            text-align: center;
        }

        h1,
        h2 {
            color: #bada;
        }

        h1 {
            font-size: 96px;
            margin: 0;
            text-shadow: 0 6px 10px darkslateblue;
        }

        h2 {
            font-size: 28px;
            margin: 0;
            text-shadow: 0 4px 4px darkslateblue;
        }

        iframe {
            display: block;
            vertical-align: top;
        }

        iframe {
            width: 100vw;
            height: auto;
            border: none;
            outline: none;
        }

        header > span {
            position: absolute;
            top: 50px;
            right: 50px;
        }

        section {
            position: relative;
            margin: 10vh auto;
        }

        .code-container {
            position: relative;
        }

        .refresh-button {
            position: absolute;
            top: 1px;
            right: 1px;
            z-index: 10;
            padding: 1em 2em;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        @media (min-width: 854px) {
            html, body {
                margin: 0;
            }

            h1 {
                font-size: 128px;
            }

            h2 {
                font-size: 32px;
            }

            section {
                display: flex;
                flex-direction: column;
                width: 854px;
            }

            iframe {
                flex: auto;
                width: 854px;
                height: 480px;
            }

            .CodeMirror {
                flex: auto;
            }

            #code1 + .CodeMirror {
                height: 125rem;
            }

            #code2 + .CodeMirror {
                height: 66rem;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css?family=Nova+Round&display=swap" rel="stylesheet">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>
<body>
    <header>
        <a class="github-button" href="https://github.com/wix-incubator/kampos" data-size="large" aria-label="Star wix-incubator/kampos on GitHub">Star</a>
        <h1>kampos</h1>
        <h2>Tiny and fast effects compositor</h2>
    </header>
    <!--<video id="video"-->
           <!--src="https://video.wixstatic.com/video/11062b_6ceb80744f45401caf9eb666caeb9887/480p/mp4/file.mp4"-->
           <!--autoplay-->
           <!--loop-->
           <!--muted-->
           <!--preload="auto"-->
           <!--crossorigin="anonymous"-->
           <!--playsinline></video>-->

    <!--<video id="video2"-->
           <!--src="https://video.wixstatic.com/video/11062b_1bb2d040b6da423fa2461982bd68bb12/480p/mp4/file.mp4"-->
           <!--autoplay-->
           <!--loop-->
           <!--muted-->
           <!--preload="auto"-->
           <!--crossorigin="anonymous"-->
           <!--playsinline></video>-->

    <template id="videos1">
        <video id="video1"
               src="./cloudy-night.mp4"
               autoplay
               loop
               muted
               preload="auto"
               crossorigin="anonymous"
               playsinline></video>

        <video id="video2"
               src="./starry-night.mp4"
               autoplay
               loop
               muted
               preload="auto"
               crossorigin="anonymous"
               playsinline></video>
    </template>

    <template id="videos2">
        <video id="video3"
               src="./wheat-field.mp4"
               autoplay
               loop
               muted
               preload="auto"
               crossorigin="anonymous"
               playsinline></video>

        <video id="video4"
               src="./shell-beach.mp4"
               autoplay
               loop
               muted
               preload="auto"
               crossorigin="anonymous"
               playsinline></video>
    </template>

    <!--<video id="video7"-->
           <!--src="https://video.wixstatic.com/video/11062b_830709c744404d6ea7a10dcfd88e3a48/480p/mp4/file.mp4"-->
           <!--autoplay-->
           <!--loop-->
           <!--muted-->
           <!--preload="auto"-->
           <!--crossorigin="anonymous"-->
           <!--playsinline></video>-->

    <!--<video id="video8"-->
           <!--src="https://video.wixstatic.com/video/11062b_ba2c921477734f8b84ef0c71f64a2562/480p/mp4/file.mp4"-->
           <!--autoplay-->
           <!--loop-->
           <!--muted-->
           <!--preload="auto"-->
           <!--crossorigin="anonymous"-->
           <!--playsinline></video>-->

    <!--<canvas id="target"></canvas>-->
    <!--<canvas id="target2"></canvas>-->
    <!--<canvas id="target3"></canvas>-->
    <section>
        <h3>Displacement transition:</h3>
        <p>
            Transition between 2 videos with a displacement effect.<br/>
            Hover the video to see it in action.
        </p>
        <iframe id="preview1" srcdoc="" sandbox="allow-scripts allow-same-origin"></iframe>
        <div class="code-container">
            <button class="refresh-button" id="refresh1">Refresh</button>
            <textarea id="code1"></textarea>
        </div>
    </section>
    <section>
        <h3>Cross-fade transition with hue-rotation:</h3>
        <p>
            Transition between 2 videos with a cross-fade effect & apply a hue-rotate filter.<br/>
            Move the mouse around over the video to see it in action.
        </p>
        <iframe id="preview2" srcdoc="" sandbox="allow-scripts allow-same-origin"></iframe>
        <div class="code-container">
            <button class="refresh-button" id="refresh2">Refresh</button>
            <textarea id="code2"></textarea>
        </div>
    </section>

    <script src="./lib/codemirror/codemirror.js"></script>
    <script src="./lib/codemirror/javascript.js"></script>
    <script>
        const text1 = document.querySelector('#code1');
        const preview1 = document.querySelector('#preview1');
        const videos1 = document.querySelector('#videos1');
        const refresh1 = document.querySelector('#refresh1');

        fetch('./disp.js')
            .then(resp => resp.text())
            .then(text => {
                text1.value = text;
                const doc = CodeMirror.fromTextArea(text1, {
                    value: text,
                    lineNumbers: true
                });

                const update = () => updatePreview(preview1, doc.getValue(), videos1.innerHTML);

                refresh1.addEventListener('click', update);

                update();
            });

        const text2 = document.querySelector('#code2');
        const preview2 = document.querySelector('#preview2');
        const videos2 = document.querySelector('#videos2');
        const refresh2 = document.querySelector('#refresh2');

        fetch('./hue-fade.js')
            .then(resp => resp.text())
            .then(text => {
                text2.value = text;
                const doc = CodeMirror.fromTextArea(text2, {
                    value: text,
                    lineNumbers: true
                });

                const update = () => updatePreview(preview2, doc.getValue(), videos2.innerHTML);

                refresh2.addEventListener('click', update);

                update();
            });
    </script>
    <script src="index.js"></script>
</body>
</html>
